<form class="{{cssClass}} {{actor.type}} flexcol" autocomplete="off">

  {{!-- Compact Header Section --}}
  <div class="sheet-header-container compact">
    {{!-- Compact Sheet Header --}}
    <header class="sheet-header compact">
      <img class="profile-img compact" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" height="60" width="60"/>
      <div class="header-fields compact">
        <h1 class="charname compact"><input name="name" type="text" value="{{actor.name}}" placeholder="Character Name"/></h1>
        <div class="resources compact flexrow">
          <div class="resource compact">
            <label class="resource-label compact">HP</label>
            <div class="resource-content compact">
              <input type="text" name="system.health.value" value="{{system.health.value}}" data-dtype="Number"/>
              <span>/</span>
              <input type="text" name="system.health.max" value="{{system.health.max}}" data-dtype="Number"/>
            </div>
          </div>
          <div class="resource compact">
            <label class="resource-label compact">Stress</label>
            <div class="resource-content compact">
              <input type="text" name="system.stress.value" value="{{system.stress.value}}" data-dtype="Number"/>
              <span>/</span>
              <input type="text" name="system.stress.max" value="{{system.stress.max}}" data-dtype="Number"/>
            </div>
          </div>
          <div class="resource compact">
            <label class="resource-label compact">Hope</label>
            <div class="resource-content compact">
              <input type="text" name="system.derived.hope.value" value="{{system.derived.hope.value}}" data-dtype="Number"/>
              <span>/</span>
              <input type="text" name="system.derived.hope.max" value="{{system.derived.hope.max}}" data-dtype="Number"/>
            </div>
            <div class="hope-controls compact">
              <button type="button" class="hope-spend compact" data-amount="1" title="Spend Hope">-</button>
              <button type="button" class="hope-gain compact" data-amount="1" title="Gain Hope">+</button>
            </div>
          </div>
        </div>
      </div>
    </header>

    {{!-- Compact Tab Navigation --}}
    <nav class="sheet-tabs tabs compact" data-group="primary">
      <a class="item" data-tab="overview">Overview</a>
      <a class="item" data-tab="heritage">Heritage</a>
      <a class="item" data-tab="class">Class</a>
      <a class="item" data-tab="inventory">Inventory</a>
      <a class="item" data-tab="roleplay">Roleplay</a>
    </nav>
  </div>

  {{!-- Scrollable Sheet Body --}}
  <section class="sheet-body" id="character-tabs">

    {{!-- Overview Tab --}}
    <div class="tab overview" data-group="primary" data-tab="overview">
      <div class="overview-single-column">
        {{!-- Ability Scores Row --}}
        <div class="abilities-section">
          <h4 class="section-title-inline">Ability Scores</h4>
          {{> "systems/daggerheart/templates/actor/parts/actor-traits.html"}}
        </div>

        {{!-- Core Stats Row --}}
        <div class="core-stats-row">
          <div class="stat-group">
            <h5 class="stat-group-title">Derived Stats</h5>
            <div class="stats-inline">
              <div class="stat-inline">
                <label class="stat-label-inline rollable" data-roll-type="trait" data-trait="agility">Evasion</label>
                <span class="stat-value-inline">{{system.derived.evasion.value}}</span>
              </div>
              <div class="stat-inline">
                <label class="stat-label-inline">Proficiency</label>
                <span class="stat-value-inline">{{system.derived.proficiency.value}}</span>
              </div>
            </div>
          </div>

          <div class="stat-group">
            <h5 class="stat-group-title">Character</h5>
            <div class="stats-inline">
              <div class="stat-inline">
                <label class="stat-label-inline">Level</label>
                <input type="number" name="system.level" value="{{system.level}}" data-dtype="Number" class="stat-input-inline"/>
              </div>
              <div class="stat-inline">
                <label class="stat-label-inline">Experience</label>
                <input type="number" name="system.experience" value="{{system.experience}}" data-dtype="Number" class="stat-input-inline"/>
              </div>
            </div>
          </div>

          <div class="stat-group">
            <h5 class="stat-group-title">Actions</h5>
            <div class="actions-inline">
              <button type="button" class="action-btn-inline short-rest">Short Rest</button>
              <button type="button" class="action-btn-inline long-rest">Long Rest</button>
              <button type="button" class="action-btn-inline stress-add" data-amount="1">+Stress</button>
              <button type="button" class="action-btn-inline stress-clear">Clear</button>
            </div>
          </div>
        </div>

        {{!-- Heritage Summary Row --}}
        <div class="heritage-summary-row">
          <h4 class="section-title-inline">Heritage Summary</h4>
          <div class="heritage-inline">
            <div class="heritage-item-inline">
              <strong>Ancestry:</strong> 
              {{#if ancestry}}{{ancestry.name}}{{else}}<em>None selected</em>{{/if}}
            </div>
            <div class="heritage-item-inline">
              <strong>Community:</strong> 
              {{#if community}}{{community.name}}{{else}}<em>None selected</em>{{/if}}
            </div>
            <div class="heritage-item-inline">
              <strong>Class:</strong> 
              {{#if classes}}
                {{#each classes as |cls|}}{{cls.name}}{{#unless @last}}, {{/unless}}{{/each}}
              {{else}}<em>None selected</em>{{/if}}
            </div>
          </div>
        </div>
      </div>
    </div>

    {{!-- Heritage Tab --}}
    <div class="tab heritage" data-group="primary" data-tab="heritage">
      <div class="grid grid-2col">
        <div class="ancestry-section">
          <div class="section-header">
            <h3>Ancestry</h3>
            <button type="button" class="compendium-browser" data-pack="daggerheart.ancestries" data-type="ancestry" title="Choose Ancestry">
              <i class="fas fa-search"></i> Browse Ancestries
            </button>
          </div>
          {{#if ancestry}}
            <div class="ancestry-display">
              <div class="item-header">
                <h4>{{ancestry.name}}</h4>
                <button type="button" class="remove-item" data-item-type="ancestry" title="Remove Ancestry">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              <div class="ancestry-description">{{{ancestry.system.description}}}</div>
              {{#each ancestry.system.features as |feature|}}
                <div class="feature">
                  <strong>{{feature.name}}:</strong> {{feature.description}}
                </div>
              {{/each}}
            </div>
          {{else}}
            <div class="no-ancestry">
              <p>No ancestry selected. Click "Browse Ancestries" to choose from the compendium.</p>
            </div>
          {{/if}}
        </div>

        <div class="community-section">
          <div class="section-header">
            <h3>Community</h3>
            <button type="button" class="compendium-browser" data-pack="daggerheart.communities" data-type="community" title="Choose Community">
              <i class="fas fa-search"></i> Browse Communities
            </button>
          </div>
          {{#if community}}
            <div class="community-display">
              <div class="item-header">
                <h4>{{community.name}}</h4>
                <button type="button" class="remove-item" data-item-type="community" title="Remove Community">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              <div class="community-description">{{{community.system.description}}}</div>
              <div class="feature">
                <strong>Community Feature:</strong> {{community.system.feature}}
              </div>
            </div>
          {{else}}
            <div class="no-community">
              <p>No community selected. Click "Browse Communities" to choose from the compendium.</p>
            </div>
          {{/if}}
        </div>
      </div>
    </div>

    {{!-- Class Tab --}}
    <div class="tab class" data-group="primary" data-tab="class">
      <div class="class-info">
        <div class="section-header">
          <h3>Class Information</h3>
          <button type="button" class="compendium-browser" data-pack="daggerheart.classes" data-type="class" title="Choose Class">
            <i class="fas fa-search"></i> Browse Classes
          </button>
        </div>
        {{#if classes}}
          {{#each classes as |cls|}}
            <div class="class-item">
              <div class="item-header">
                <h4>{{cls.name}}</h4>
                <button type="button" class="remove-item" data-item-type="class" data-item-id="{{cls._id}}" title="Remove Class">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              {{#if (eq cls.type "class")}}
                <div class="class-details">
                  <p><strong>Level:</strong> {{cls.system.level}}</p>
                  <p><strong>HP Bonus:</strong> +{{cls.system.hpBonus}}</p>
                  <p><strong>Evasion Bonus:</strong> +{{cls.system.evasionBonus}}</p>
                  {{#if cls.system.classItem}}
                    <p><strong>Class Item:</strong> {{cls.system.classItem}}</p>
                  {{/if}}
                  {{#if cls.system.hopeFeature}}
                    <div class="hope-feature">
                      <strong>Hope Feature:</strong> {{cls.system.hopeFeature}}
                    </div>
                  {{/if}}
                  {{#if cls.system.coreFeature}}
                    <div class="core-feature">
                      <strong>Core Feature:</strong> {{cls.system.coreFeature}}
                    </div>
                  {{/if}}
                </div>
              {{else}}
                <div class="subclass-details">
                  <p><strong>Type:</strong> Subclass</p>
                  {{#if cls.system.spellcastingTrait}}
                    <p><strong>Spellcasting Trait:</strong> {{cls.system.spellcastingTrait}}</p>
                  {{/if}}
                  {{#if cls.system.foundationFeature}}
                    <div class="foundation-feature">
                      <strong>Foundation:</strong> {{cls.system.foundationFeature}}
                    </div>
                  {{/if}}
                  {{#if cls.system.specializationFeature}}
                    <div class="specialization-feature">
                      <strong>Specialization:</strong> {{cls.system.specializationFeature}}
                    </div>
                  {{/if}}
                  {{#if cls.system.masteryFeature}}
                    <div class="mastery-feature">
                      <strong>Mastery:</strong> {{cls.system.masteryFeature}}
                    </div>
                  {{/if}}
                </div>
              {{/if}}
              <div class="class-description">{{{cls.system.description}}}</div>
            </div>
          {{/each}}
        {{else}}
          <p>No class selected. Click "Browse Classes" to choose from the compendium.</p>
        {{/if}}
      </div>

      <div class="domain-cards">
        {{> "systems/daggerheart/templates/actor/parts/actor-loadout.html"}}
      </div>
    </div>

    {{!-- Inventory Tab --}}
    <div class="tab inventory" data-group="primary" data-tab="inventory">
      {{> "systems/daggerheart/templates/actor/parts/actor-inventory.html"}}
    </div>

    {{!-- Roleplay Tab --}}
    <div class="tab roleplay" data-group="primary" data-tab="roleplay">
      <div class="grid grid-2col">
        <div class="experiences">
          {{> "systems/daggerheart/templates/actor/parts/actor-experiences.html"}}
        </div>
        <div class="connections">
          {{> "systems/daggerheart/templates/actor/parts/actor-connections.html"}}
        </div>
      </div>
      
      <div class="biography">
        <h3>Biography</h3>
        {{editor system.biography target="system.biography" button=true owner=owner editable=editable}}
      </div>
      
      <div class="notes">
        <h3>Notes</h3>
        {{editor system.notes target="system.notes" button=true owner=owner editable=editable}}
      </div>
    </div>

  </section>
</form> 