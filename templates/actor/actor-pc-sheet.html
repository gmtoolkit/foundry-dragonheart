<form class="{{cssClass}} {{actor.type}} flexcol" autocomplete="off">

  {{!-- Header Section --}}
  <div class="sheet-header-container">
    <header class="sheet-header">
      <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" height="80" width="80"/>
      <div class="header-fields">
        <h1 class="charname"><input name="name" type="text" value="{{actor.name}}" placeholder="Character Name"/></h1>
        <div class="resources flexrow">
          <div class="resource">
            <label class="resource-label">HP</label>
            <div class="resource-content">
              <input type="text" name="system.health.value" value="{{system.health.value}}" data-dtype="Number"/>
              <span>/</span>
              <input type="text" name="system.health.max" value="{{system.health.max}}" data-dtype="Number"/>
            </div>
          </div>
          <div class="resource">
            <label class="resource-label">Stress</label>
            <div class="resource-content">
              <input type="text" name="system.stress.value" value="{{system.stress.value}}" data-dtype="Number"/>
              <span>/</span>
              <input type="text" name="system.stress.max" value="{{system.stress.max}}" data-dtype="Number"/>
            </div>
          </div>
          <div class="resource">
            <label class="resource-label">Hope</label>
            <div class="resource-content">
              <input type="text" name="system.derived.hope.value" value="{{system.derived.hope.value}}" data-dtype="Number"/>
              <span>/</span>
              <input type="text" name="system.derived.hope.max" value="{{system.derived.hope.max}}" data-dtype="Number"/>
            </div>
            <div class="hope-controls">
              <button type="button" class="hope-spend" data-amount="1" title="Spend Hope">-</button>
              <button type="button" class="hope-gain" data-amount="1" title="Gain Hope">+</button>
            </div>
          </div>
        </div>
      </div>
    </header>

    {{!-- Tab Navigation --}}
    <nav class="sheet-tabs tabs" data-group="primary">
      <a class="item" data-tab="overview">Overview</a>
      <a class="item" data-tab="heritage">Heritage</a>
      <a class="item" data-tab="class">Class</a>
      <a class="item" data-tab="inventory">Inventory</a>
      <a class="item" data-tab="roleplay">Roleplay</a>
    </nav>
  </div>

  {{!-- Sheet Body --}}
  <section class="sheet-body" id="character-tabs">

    {{!-- Overview Tab --}}
    <div class="tab overview" data-group="primary" data-tab="overview">
      
      {{!-- Character Info Row --}}
      <div class="character-info">
        <div class="info-group">
          <label>Heritage:</label>
          <input type="text" name="system.heritage" value="{{system.heritage}}" placeholder="Heritage"/>
        </div>
        <div class="info-group">
          <label>Subclass:</label>
          <input type="text" name="system.subclass" value="{{system.subclass}}" placeholder="Subclass"/>
        </div>
        <div class="info-group">
          <label>Level:</label>
          <input type="number" name="system.level" value="{{system.level}}" data-dtype="Number"/>
        </div>
      </div>

      {{!-- Ability Scores --}}
      <div class="abilities-section">
        <h3>Ability Scores</h3>
        <div class="abilities-grid">
          {{#each system.traits as |trait key|}}
            <div class="ability-box">
              <div class="ability-name">{{capitalize key}}</div>
              <div class="ability-score">
                <input type="text" name="system.traits.{{key}}.value" value="{{trait.value}}" data-dtype="Number"/>
              </div>
              <div class="ability-modifier">{{numberFormat trait.mod decimals=0 sign=true}}</div>
              <button type="button" class="ability-roll rollable" data-roll-type="trait" data-trait="{{key}}" title="Roll {{capitalize key}}">
                <i class="fas fa-dice-d20"></i>
              </button>
            </div>
          {{/each}}
        </div>
      </div>

      {{!-- Two Column Layout --}}
      <div class="overview-columns">
        <div class="left-col">
          
          {{!-- Defense --}}
          <div class="defense-box">
            <h4>Defense</h4>
            <div class="defense-line">
              <label>Evasion:</label>
              <span>{{system.derived.evasion.value}}</span>
            </div>
          </div>

          {{!-- Health Tracking --}}
          <div class="health-box">
            <h4>Health & Damage</h4>
            <div class="health-tracks">
              <div class="damage-track">
                <label>Minor (1 HP):</label>
                <div class="track-boxes">
                  <div class="track-box"></div>
                  <div class="track-box"></div>
                  <div class="track-box"></div>
                  <div class="track-box"></div>
                  <div class="track-box"></div>
                  <div class="track-box"></div>
                </div>
              </div>
              <div class="damage-track">
                <label>Major (2 HP):</label>
                <div class="track-boxes">
                  <div class="track-box"></div>
                  <div class="track-box"></div>
                  <div class="track-box"></div>
                  <div class="track-box"></div>
                  <div class="track-box"></div>
                  <div class="track-box"></div>
                </div>
              </div>
              <div class="damage-track">
                <label>Severe (3 HP):</label>
                <div class="track-boxes">
                  <div class="track-box"></div>
                  <div class="track-box"></div>
                  <div class="track-box"></div>
                  <div class="track-box"></div>
                  <div class="track-box"></div>
                  <div class="track-box"></div>
                </div>
              </div>
              <div class="stress-track">
                <label>Stress:</label>
                <div class="track-boxes">
                  <div class="track-box"></div>
                  <div class="track-box"></div>
                  <div class="track-box"></div>
                  <div class="track-box"></div>
                  <div class="track-box"></div>
                  <div class="track-box"></div>
                </div>
              </div>
            </div>
          </div>

        </div>
        
        <div class="right-col">
          
          {{!-- Hope Tracking --}}
          <div class="hope-box">
            <h4>Hope</h4>
            <p>Spend a Hope to use an experience or help an ally.</p>
            <div class="hope-track">
              <div class="hope-diamond"></div>
              <div class="hope-diamond"></div>
              <div class="hope-diamond"></div>
              <div class="hope-diamond"></div>
              <div class="hope-diamond"></div>
              <div class="hope-diamond"></div>
            </div>
          </div>

          {{!-- Experience --}}
          <div class="experience-box">
            <h4>Experience</h4>
            {{#each features as |experience|}}
              <div class="experience-line">
                <input type="text" value="{{experience.name}}" class="experience-name"/>
                <span class="experience-bonus">+{{experience.system.modifier}}</span>
              </div>
            {{/each}}
            {{#unless features}}
              <div class="experience-line">
                <input type="text" placeholder="Experience" class="experience-name"/>
                <span class="experience-bonus">+0</span>
              </div>
              <div class="experience-line">
                <input type="text" placeholder="Experience" class="experience-name"/>
                <span class="experience-bonus">+0</span>
              </div>
            {{/unless}}
          </div>

        </div>
      </div>
    </div>

    {{!-- Heritage Tab --}}
    <div class="tab heritage" data-group="primary" data-tab="heritage">
      <div class="grid grid-2col">
        <div class="ancestry-section">
          <div class="section-header">
            <h3>Ancestry</h3>
            <button type="button" class="compendium-browser" data-pack="daggerheart.ancestries" data-type="ancestry" title="Choose Ancestry">
              <i class="fas fa-search"></i> Browse Ancestries
            </button>
          </div>
          {{#if ancestry}}
            <div class="ancestry-display">
              <div class="item-header">
                <h4>{{ancestry.name}}</h4>
                <button type="button" class="remove-item" data-item-type="ancestry" title="Remove Ancestry">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              <div class="ancestry-description">{{{ancestry.system.description}}}</div>
            </div>
          {{else}}
            <div class="no-ancestry">
              <p>No ancestry selected. Click "Browse Ancestries" to choose from the compendium.</p>
            </div>
          {{/if}}
        </div>

        <div class="community-section">
          <div class="section-header">
            <h3>Community</h3>
            <button type="button" class="compendium-browser" data-pack="daggerheart.communities" data-type="community" title="Choose Community">
              <i class="fas fa-search"></i> Browse Communities
            </button>
          </div>
          {{#if community}}
            <div class="community-display">
              <div class="item-header">
                <h4>{{community.name}}</h4>
                <button type="button" class="remove-item" data-item-type="community" title="Remove Community">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              <div class="community-description">{{{community.system.description}}}</div>
            </div>
          {{else}}
            <div class="no-community">
              <p>No community selected. Click "Browse Communities" to choose from the compendium.</p>
            </div>
          {{/if}}
        </div>
      </div>
    </div>

    {{!-- Class Tab --}}
    <div class="tab class" data-group="primary" data-tab="class">
      <div class="class-info">
        <div class="section-header">
          <h3>Class Information</h3>
          <button type="button" class="compendium-browser" data-pack="daggerheart.classes" data-type="class" title="Choose Class">
            <i class="fas fa-search"></i> Browse Classes
          </button>
        </div>
        {{#if classes}}
          {{#each classes as |cls|}}
            <div class="class-item">
              <div class="item-header">
                <h4>{{cls.name}}</h4>
                <button type="button" class="remove-item" data-item-type="class" data-item-id="{{cls._id}}" title="Remove Class">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              <div class="class-description">{{{cls.system.description}}}</div>
            </div>
          {{/each}}
        {{else}}
          <p>No class selected. Click "Browse Classes" to choose from the compendium.</p>
        {{/if}}
      </div>
    </div>

    {{!-- Inventory Tab --}}
    <div class="tab inventory" data-group="primary" data-tab="inventory">
      {{> "systems/daggerheart/templates/actor/parts/actor-inventory.html"}}
    </div>

    {{!-- Roleplay Tab --}}
    <div class="tab roleplay" data-group="primary" data-tab="roleplay">
      <div class="grid grid-2col">
        <div class="experiences">
          {{> "systems/daggerheart/templates/actor/parts/actor-experiences.html"}}
        </div>
        <div class="connections">
          {{> "systems/daggerheart/templates/actor/parts/actor-connections.html"}}
        </div>
      </div>
      
      <div class="biography">
        <h3>Biography</h3>
        {{editor system.biography target="system.biography" button=true owner=owner editable=editable}}
      </div>
      
      <div class="notes">
        <h3>Notes</h3>
        {{editor system.notes target="system.notes" button=true owner=owner editable=editable}}
      </div>
    </div>

  </section>
</form> 